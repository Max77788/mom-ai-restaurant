{% extends "layout_no_land.html" %}

{% block content %}
<div id="instructions" style="border-top: 1px solid black; font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background-color: #f9f9f9; border-radius: 8px;">
    <h2 style="text-align: center; margin-top: 20px; color: #2c3e50;">The List of AI-Empowered Restaurants</h2>
    <p style="text-align: center; color: #7f8c8d;">Learn more and click on 'Order Food Now' to make the order with AI:</p>

    <h3 style="text-align: center;">Filter by location</h3>
    <!-- Location Search Input -->
    <div style="text-align: center; margin-bottom: 20px;">
        <input id="location-input" type="text" placeholder="Enter a location" value="{{ search_query }}" style="width: 100%; max-width: 400px; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
        <button onclick="searchRestaurants()" style="margin-top: 10px; padding: 10px 20px;">Search</button>
    </div>

    <div class="grid-container">
        {% for restaurant in restaurants %}
        <div class="grid-item">
            <h3>{{ restaurant.name.replace("_", " ") }}</h3>
            {% if restaurant.isOpen and restaurant.assistant_turned_on %}
                <p style="color:#00ff00"><strong>Open</strong></p>
            {% elif restaurant.isOpen and not restaurant.assistant_turned_on %}
                <p style="color:brown"><strong>AI-Assistant Paused</strong></p>
            {% else %}
                <p style="color:#ff0000"><strong>Currently Closed</strong></p>
            {% endif %}
            <!-- Logo display -->
            <div class="restaurant-logo" style="text-align: center; margin-bottom: 10px;">
                <img src="{{ url_for('serve_image', file_id=restaurant.res_logo or '666af654dee400a1d635eb08') }}" alt="Restaurant Logo" class="restaurant-logo-img">
            </div>
            {% if restaurant.website_url != 'No URL provided' %}
               <p><a href="{{ restaurant.website_url }}" style="color: #0000ff;" target="_blank">Visit the website</a></p>
            {% else %}
            <p>No URL Provided</p>
            {% endif %}
            <!--
            <p><b>Contact the restaurant:</b></p>
            <p style="margin-bottom: 3px"><a href="mailto:{{ restaurant.email }}">{{ restaurant.email }}</a></p>
            -->
            <p><b>Location:</b></p>
            <p style="font-size: 13px;"><b>{{ restaurant.location_name }}</b></pp>
            <!--
            <p><b>Location:</b></p>
            <p style="margin-bottom: 3px">{{ restaurant.get('location_name', 'Not provided') }}</p>
            -->
            <p><a href="https://www.google.com/maps/search/?api=1&query={{ restaurant.get('location_name') }}" target="_blank" style="color: #0000ff; margin-bottom: 10px;">View on the Map</a></p>

            <p style="padding-bottom: 7px"><a href="/restaurant/{{ restaurant.unique_azz_id }}" target="_blank"><button>Visit Profile</button></a></p>
            
            <p><a href="/assistant_order_chat/{{ restaurant.unique_azz_id }}" target="_blank"><button>Order Food Now</button></a></p>
        </div>
        {% endfor %}
    </div>

    <div class="pagination" style="text-align: center; margin-top: 20px;">
        {% if page > 1 %}
        <a href="{{ url_for('market_dashboard', page=page-1, location=search_query) }}" style="margin-right: 10px; text-decoration: none; color: #007bff; font-weight: bold;">Previous</a>
        {% endif %}
        <span style="padding: 0 10px; font-weight: bold;">Page {{ page }} of {{ (total // per_page) + 1 }}</span>
        {% if (page * per_page) < total %}
        <a href="{{ url_for('market_dashboard', page=page+1, location=search_query) }}" style="margin-left: 10px; text-decoration: none; color: #007bff; font-weight: bold;">Next</a>
        {% endif %}
    </div>
</div>

<style>
    .grid-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }

    .grid-item {
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .restaurant-logo-img {
        height: 137px;
        width: auto;
        max-width: 200px;
        max-height: 200px;
    }

    @media (max-width: 768px) {
        .grid-container {
            grid-template-columns: 1fr;
        }
    }
</style>

<script>
    function initAutocomplete() {
        const input = document.getElementById('location-input');
        const autocomplete = new google.maps.places.Autocomplete(input);
    }

    function searchRestaurants() {
        const locationInput = document.getElementById('location-input').value;
        const url = new URL(window.location.href);
        url.searchParams.set('location', locationInput);
        window.location.href = url.href;
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&libraries=places&callback=initAutocomplete" async defer></script>
{% endblock %}
